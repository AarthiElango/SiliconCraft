<nav class="navbar navbar-expand-lg bg-white navbar-primary sticky-top shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="index.html">
      <img src="images/logo.png" alt="Logo" height="50" />
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="index.html">Home</a>
        </li>
        
        <!-- Courses Dropdown -->
        <li class="nav-item dropdown mega-dropdown">
          <a 
            class="nav-link dropdown-toggle" 
            href="#" 
            role="button" 
            data-bs-toggle="dropdown" 
            aria-expanded="false"
            id="coursesDropdown"
            data-bs-auto-close="outside"
          >
            Courses
          </a>
          <ul class="dropdown-menu" aria-labelledby="coursesDropdown">
            <!-- Long Term Courses Nested Dropdown -->
            <li class="dropdown dropend">
              <a 
                class="dropdown-item dropdown-toggle"
                href="courses.html#long-term"
                role="button"
              >
                Long Term
              </a>
              <ul class="dropdown-menu dropdown-submenu">
                <li>
                  <a 
                    class="dropdown-item course-link" 
                    href="#"
                    data-page="courses.html"
                    data-section="long-term"
                    data-modal="advanced-asic-design-verification"
                  >
                    Advanced ASIC Design & Verification
                  </a>
                </li>
                <li>
                  <a 
                    class="dropdown-item course-link" 
                    href="javascript:void(0)"
                    data-page="courses.html"
                    data-section="long-term"
                    data-modal="physical-design"
                  >
                    Physical Design
                  </a>
                </li>
                <li>
                  <a 
                    class="dropdown-item course-link" 
                    href="javascript:void(0)"
                    data-page="courses.html"
                    data-section="long-term"
                    data-modal="fpga-based-system-design"
                  >
                    FPGA Based System Design
                  </a>
                </li>
                <li>
                  <a 
                    class="dropdown-item course-link" 
                    href="javascript:void(0)"
                    data-page="courses.html"
                    data-section="long-term"
                    data-modal="advanced-embedded-systems"
                  >
                    Advanced Embedded Systems
                  </a>
                </li>
              </ul>
            </li>
            
            <!-- Internship Nested Dropdown -->
            <li class="dropdown dropend">
              <a 
                class="dropdown-item dropdown-toggle"
                href="internship.html"
                role="button"
              >
                Internship
              </a>
              <ul class="dropdown-menu dropdown-submenu">
                <li>
                  <a 
                    class="dropdown-item internship-link" 
                    href="#"
                    data-page="internship.html"
                    data-modal="vlsi-design-internship"
                  >
                    VLSI Design Internship
                  </a>
                </li>
                <li>
                  <a 
                    class="dropdown-item internship-link" 
                    href="javascript:void(0)"
                    data-page="internship.html"
                    data-modal="embedded-systems-internship"
                  >
                    Embedded Systems Internship
                  </a>
                </li>
              </ul>
            </li>
            
            <!-- Short Term Direct Link -->
            <!-- <li>
              <a class="dropdown-item" href="courses.html#short-term">Short Term</a>
            </li> -->
          </ul>
        </li>
        
        <li class="nav-item">
          <a class="nav-link" href="about.html">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="placement.html">Placement</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="admissions.html">Admissions</a>
        </li>
        
        <!-- Highlights Dropdown -->
        <li class="nav-item dropdown">
          <a 
            class="nav-link dropdown-toggle" 
            href="highlights.html" 
            role="button" 
            data-bs-toggle="dropdown" 
            aria-expanded="false"
            data-bs-auto-close="outside"
          >
            Highlights
          </a>
          <ul class="dropdown-menu">
            <li>
              <a class="dropdown-item highlights-link" href="javascript:void(0)" data-tab="mous">
                ItoA Connect
              </a>
            </li>
            <li>
              <a class="dropdown-item highlights-link" href="javascript:void(0)" data-tab="events">
                External Events
              </a>
            </li>
            <li>
              <a class="dropdown-item highlights-link" href="javascript:void(0)" data-tab="awards">
                Internal Events
              </a>
            </li>
             <li>
              <a class="dropdown-item" href=highlights.html#explore>
              Explore More!
              </a>
            </li>
          </ul>
        </li>
        
        <li class="nav-item">
          <a class="nav-link" href="contact.html">Contact</a>
        </li>
        <li class="nav-item">
          <a class="nav-link apply-now-btn" href="admissions.html#apply">Apply Now</a>
        </li>
      </ul>
    </div>
  </div>
</nav>
<script>
document.addEventListener('DOMContentLoaded', function() {
  
  // ======================
  // COURSE LINKS HANDLER
  // ======================
  document.querySelectorAll('.course-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const page = this.getAttribute('data-page');
      const section = this.getAttribute('data-section');
      const modalId = this.getAttribute('data-modal');
      
      sessionStorage.setItem('navigationType', 'course');
      sessionStorage.setItem('targetPage', page);
      sessionStorage.setItem('targetSection', section);
      sessionStorage.setItem('targetModal', modalId);
      
      closeAllDropdowns();
      window.location.href = page;
    });
  });
  
  // ======================
  // INTERNSHIP LINKS HANDLER
  // ======================
  document.querySelectorAll('.internship-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const page = this.getAttribute('data-page');
      const modalId = this.getAttribute('data-modal');
      
      sessionStorage.setItem('navigationType', 'internship');
      sessionStorage.setItem('targetPage', page);
      sessionStorage.setItem('targetModal', modalId);
      
      closeAllDropdowns();
      window.location.href = page;
    });
  });
  
  // ======================
  // HIGHLIGHTS LINKS HANDLER
  // ======================
  document.querySelectorAll('.highlights-link').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      const tabName = this.getAttribute('data-tab');
      
      sessionStorage.setItem('navigationType', 'highlights');
      sessionStorage.setItem('targetTab', tabName);
      
      closeAllDropdowns();
      window.location.href = 'highlights.html';
    });
  });
  
  // ======================
  // PAGE LOAD HANDLER - COURSES
  // ======================
  if (window.location.pathname.includes('courses.html')) {
    const navType = sessionStorage.getItem('navigationType');
    
    if (navType === 'course') {
      const section = sessionStorage.getItem('targetSection');
      const modalId = sessionStorage.getItem('targetModal');
      
      sessionStorage.removeItem('navigationType');
      sessionStorage.removeItem('targetPage');
      sessionStorage.removeItem('targetSection');
      sessionStorage.removeItem('targetModal');
      
      if (section && modalId) {
        setTimeout(() => {
          const sectionElement = document.getElementById(section);
          if (sectionElement) {
            sectionElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
          
          setTimeout(() => {
            const modalElement = document.querySelector(`.${modalId}`);
            if (modalElement && typeof bootstrap !== 'undefined') {
              const modal = new bootstrap.Modal(modalElement);
              modal.show();
            }
          }, 800);
        }, 300);
      }
    }
  }
  
  // ======================
  // PAGE LOAD HANDLER - INTERNSHIP
  // ======================
  if (window.location.pathname.includes('internship.html')) {
    const navType = sessionStorage.getItem('navigationType');
    
    if (navType === 'internship') {
      const modalId = sessionStorage.getItem('targetModal');
      
      sessionStorage.removeItem('navigationType');
      sessionStorage.removeItem('targetPage');
      sessionStorage.removeItem('targetModal');
      
      if (modalId) {
        setTimeout(() => {
          const modalElement = document.querySelector(`.${modalId}`);
          if (modalElement && typeof bootstrap !== 'undefined') {
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
          }
        }, 500);
      }
    }
  }
  
  // ======================
  // PAGE LOAD HANDLER - HIGHLIGHTS
  // ======================
  if (window.location.pathname.includes('highlights.html')) {
    const navType = sessionStorage.getItem('navigationType');
    
    if (navType === 'highlights') {
      const tabName = sessionStorage.getItem('targetTab');
      
      sessionStorage.removeItem('navigationType');
      sessionStorage.removeItem('targetTab');
      
      if (tabName) {
        setTimeout(() => {
          const tabButton = document.querySelector(`button[data-bs-target="#${tabName}-tab-pane"]`);
          if (tabButton && typeof bootstrap !== 'undefined') {
            const tab = new bootstrap.Tab(tabButton);
            tab.show();
          }
        }, 300);
      }
    }
  }
  
  // ======================
  // DESKTOP HOVER BEHAVIOR (992px and above)
  // ======================
  if (window.innerWidth >= 992) {
    document.querySelectorAll('.dropdown-menu .dropdown, .dropdown-menu .dropend').forEach(function(dropdownEl) {
      dropdownEl.addEventListener('mouseenter', function() {
        const submenu = this.querySelector('.dropdown-menu');
        if (submenu) {
          submenu.classList.add('show');
        }
      });
      
      dropdownEl.addEventListener('mouseleave', function() {
        const submenu = this.querySelector('.dropdown-menu');
        if (submenu) {
          submenu.classList.remove('show');
        }
      });
    });
  }
  
  // ======================
  // MOBILE/TABLET CLICK BEHAVIOR (Below 992px)
  // ======================
  if (window.innerWidth < 992) {
    
    // Disable Bootstrap's auto-toggle for nested dropdowns
    document.querySelectorAll('.dropdown-menu .dropdown-toggle').forEach(function(toggle) {
      // Remove data-bs-toggle temporarily to prevent Bootstrap interference
      toggle.removeAttribute('data-bs-toggle');
      
      toggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const parentDropdown = this.closest('.dropdown, .dropend');
        const menu = parentDropdown.querySelector(':scope > .dropdown-menu');
        
        if (menu) {
          const isShown = menu.classList.contains('show');
          
          // Close all sibling nested dropdowns
          const siblings = parentDropdown.parentElement.querySelectorAll(':scope > .dropdown > .dropdown-menu.show, :scope > .dropend > .dropdown-menu.show');
          siblings.forEach(function(sibling) {
            if (sibling !== menu) {
              sibling.classList.remove('show');
            }
          });
          
          // Toggle the clicked dropdown
          menu.classList.toggle('show');
        }
      });
    });
    
    // Prevent clicking inside dropdown from closing it
    document.querySelectorAll('.dropdown-menu').forEach(function(menu) {
      menu.addEventListener('click', function(e) {
        // Only stop propagation if not clicking final destination links
        if (!e.target.classList.contains('course-link') && 
            !e.target.classList.contains('internship-link') && 
            !e.target.classList.contains('highlights-link') &&
            !e.target.href || e.target.href.includes('#') || e.target.href.includes('javascript:void(0)')) {
          e.stopPropagation();
        }
      });
    });
  }
  
  // ======================
  // UTILITY FUNCTIONS
  // ======================
  function closeAllDropdowns() {
    document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
      menu.classList.remove('show');
    });
    
    const navbar = document.querySelector('.navbar-collapse');
    if (navbar && navbar.classList.contains('show')) {
      const bsCollapse = bootstrap.Collapse.getInstance(navbar);
      if (bsCollapse) {
        bsCollapse.hide();
      } else {
        const toggler = document.querySelector('.navbar-toggler');
        if (toggler) toggler.click();
      }
    }
  }
  
  // ======================
  // ACTIVE PAGE INDICATOR
  // ======================
  const currentPage = window.location.pathname.split('/').pop() || 'index.html';
  document.querySelectorAll('.navbar-nav > .nav-item > .nav-link').forEach(function(link) {
    const href = link.getAttribute('href');
    if (href && href.includes(currentPage.split('#')[0])) {
      link.classList.add('active');
    }
  });
  
  // ======================
  // WINDOW RESIZE HANDLER
  // ======================
  let resizeTimer;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      closeAllDropdowns();
    }, 250);
  });
});
</script>